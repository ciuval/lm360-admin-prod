// src/lib/analytics.js
import { supabase } from "./supabaseClient";

/**
 * track(name, props) â†’ salva un evento. Nessuna PII.
 * Funziona anche da anonimo (vedi policy sotto).
 */
export async function track(name, props = {}) {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    const payload = {
      user_id: user?.id ?? null,
      name,
      props, // jsonb
    };
    const { error } = await supabase.from("events").insert(payload);
    if (error) throw error;
  } catch {
    // silenzioso, niente PII nei log
  }
}
